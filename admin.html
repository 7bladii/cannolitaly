<script>
    const loginForm = document.getElementById('login-form');
    const errorMessage = document.getElementById('error-message');
    const loginButton = loginForm.querySelector('button'); // Get the button

    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = loginForm.email.value;
        const password = loginForm.password.value;

        // --- REFINEMENT 1: Add a loading state ---
        errorMessage.textContent = ''; // Clear previous errors
        loginButton.disabled = true;
        loginButton.textContent = 'Logging in...';

        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                // If login is successful, redirect to the dashboard
                window.location.href = 'dashboard.html';
            })
            .catch((error) => {
                // --- REFINEMENT 2: User-friendly error messages ---
                switch (error.code) {
                    case 'auth/user-not-found':
                    case 'auth/wrong-password':
                    case 'auth/invalid-credential': // Catches both wrong email and password
                        errorMessage.textContent = 'Incorrect email or password. Please try again.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage.textContent = 'Please enter a valid email address.';
                        break;
                    default:
                        errorMessage.textContent = 'An unexpected error occurred. Please try again later.';
                        break;
                }
                console.error("Login Error Code:", error.code); // For debugging
            })
            .finally(() => {
                // This runs after success or failure to re-enable the button
                loginButton.disabled = false;
                loginButton.textContent = 'Login';
            });
    });
</script>